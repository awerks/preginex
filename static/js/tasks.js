import{toast,confirmBox}from"./utils.js";function completeTask(e,t){let n=document.querySelector(".fc-task-status");fetch(COMPLETE_TASK_URL+"/"+e,{method:"PATCH",headers:{"Content-Type":"application/json"}}).then(e=>{e.ok?(t.innerText="Completed",t.disabled=!0,t.classList.add("completed"),n.innerText="Status: Completed",n.classList.add("completed"),toast("Task marked as completed!","success")):(t.innerText="Failed",t.disabled=!0,n.innerText="Status: Failed",n.classList.add("failed"),toast("Failed to mark task as completed.","error"))}).catch(e=>{console.error("Error:",e),toast("An error occurred while completing the task.","error")})}function deleteTask(e){fetch(DELETE_TASK_URL+"/"+e,{method:"DELETE",headers:{"Content-Type":"application/json"}}).then(e=>{e.ok?toast("Task deleted successfully!","success"):toast("Failed to delete task.","error"),setTimeout(()=>{location.reload()},1e3)}).catch(e=>{console.error("Error:",e),toast("An error occurred while deleting the task.","error")})}document.addEventListener("DOMContentLoaded",function(){var e=document.getElementById("taskCalendar"),t=window.innerWidth<768,e=(new FullCalendar.Calendar(e,{initialView:t?"listWeek":"dayGridMonth",headerToolbar:t?{left:"prev,next",right:"today"}:{left:"title",right:"prev,next,dayGridMonth,timeGridWeek,timeGridDay,listWeek"},height:"auto",events:GET_TASKS_URL,eventDidMount:function(e){e.event.extendedProps.description&&tippy(e.el,{content:"Description: "+e.event.extendedProps.description,placement:"top",arrow:!0})},eventContent:function(t){var n=document.createElement("div"),s=(n.classList.add("fc-event-title"),n.innerText=t.event.title,document.createElement("div"));s.classList.add("fc-task-assigned");let e=t.event.extendedProps.assigned_username;e==USERNAME&&(e="you"),s.innerText="Assigned to "+e;var d,a=document.createElement("div");if(a.classList.add("fc-task-status"),a.innerText="Status: "+t.event.extendedProps.status,"Completed"===t.event.extendedProps.status&&"Admin"===USER_ROLE||"Manager"===USER_ROLE)return a.classList.add("completed"),(d=document.createElement("button")).innerText="Delete",d.classList.add("fc-delete-btn"),d.onclick=async function(){await confirmBox(`Delete ${t.event.title}?`,"Delete")&&deleteTask(t.event.extendedProps.task_id)},{domNodes:[n,s,a,d]};if("Failed"===t.event.extendedProps.status&&a.classList.add("failed"),"Pending"!==t.event.extendedProps.status||"Worker"!==USER_ROLE)return{domNodes:[n,s,a]};{let e=document.createElement("button");return e.innerText="Complete",e.classList.add("fc-approve-btn"),e.onclick=function(){completeTask(t.event.extendedProps.task_id,e)},{domNodes:[n,s,a,e]}}}}).render(),document.querySelector(".task-form"));e&&e.addEventListener("submit",function(e){new Date(document.getElementById("deadline").value)<new Date?(e.preventDefault(),toast("Deadline cannot be in the past.","error")):toast("Task added successfully!","success")})});